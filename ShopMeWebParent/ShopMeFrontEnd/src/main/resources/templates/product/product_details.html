<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<th:block th:replace="fragments/page_structure :: page_header(${pageTitle})"></th:block>
<body>
    <div class="container">
        <th:block th:replace="fragments/navigation :: header_nav"></th:block>
        <th:block th:replace="fragments/navigation :: search_nav"></th:block>
        <th:block th:replace="fragments/breadcrumb :: content"></th:block>
        <div class="row p-3">
            <div class="col-sm-4">
                <div class="d-flex justify-content-center">
                    <img id="bigImage" style="height: 320px; max-width: 500px; object-fit: contain;"
                         class="m-2" th:src="@{${product.mainImagePath}}" height="320" />
                </div>
                <div class="row justify-content-center">
                    <div class="col-2 col-sm-2 col-md-2 col-lg-1 m-2 p-1 border border-secondary">
                        <img class="image-thumbnail img-fluid" th:src="@{${product.mainImagePath}}" width="50" index="0" />
                    </div>
                    <th:block th:each="extraImage, status : ${product.images}">
                        <div class="col-2 col-sm-2 col-md-2 col-lg-1 m-2 p-1 border border-secondary">
                            <img class="image-thumbnail img-fluid" th:src="@{${extraImage.imagePath}}" width="50" th:index="${status.count}" />
                        </div>
                    </th:block>
                </div>
            </div>
            <div class="col p-3">
                <div><h3>[[${product.name}]]</h3></div>
                <div class="d-flex ml-1 mb-1">
                    <div>
                        <input type="text" class="product-details-star-rating" dir="ltr" data-size="md" th:value="${product.averageRating}" />
                    </div>
                    <div class="mt-4"><a href="#reviews">[[${product.reviewCount}]] rating(s)</a></div>
                </div>
                <div><span>Brand: [[${product.brand.name}]]</span></div>
                <th:block th:replace="fragments/product_fragment :: price_for_details"></th:block>
                <div th:utext="${product.shortDescription}"></div>
            </div>
            <div class="col-sm-2 d-flex flex-column align-items-center">
                <th:block th:if="${product.inStock}">
                    <span class="text-success mb-2"><b>In Stock</b></span>
                    <th:block th:replace="cart/quantity_control::content(1, ${product.id})"></th:block>
                    <div>
                        <input type="button" id="addToCart" value="Add to Card" class="btn btn-primary">
                    </div>
                </th:block>
                <th:block th:if="${!product.inStock}">
                    <span class="text-danger"><b>Out Of Stock</b></span>
                </th:block>
            </div>
        </div>
        <div class="row  p-3">
            <div class="col-12">
                <div><hr></div>
                <div><h3>Product Description</h3></div>
                <div th:utext="${product.fullDescription}"></div>
            </div>
        </div>
        <div class="row  p-3">
            <div class="col-12">
                <div><hr></div>
                <div><h3>Product Details</h3></div>
                <th:block th:each="detail : ${product.details}">
                    <div>
                        <b>[[${detail.name}]]</b>:
                        <span>[[${detail.value}]]</span>
                    </div>
                </th:block>
            </div>
        </div>
        <div id="reviews" class="row p-3">
            <div class="col-12">
                <div><hr></div>
                <th:block th:if="${product.reviewCount > 0}">
                    <div><h3>Customer Reviews</h3></div>
                    <div class="d-flex ms-1 mb-1">
                        <div>
                            <input type="text" class="product-details-star-rating" dir="ltr" data-size="md" th:value="${product.averageRating}" />
                        </div>
                        <div class="mt-3 ms-1">
                            <th:block th:replace="fragments/rating_fragment :: rating_formatter(${product.averageRating})"></th:block>
                        </div>
                    </div>
                    <div class="mt-2 mb-4" th:if="${product.reviewCount > 3}">
                        <a th:href="@{'/ratings/' + ${product.alias}}">View all [[${product.reviewCount}]] rating(s)</a>
                    </div>
                </th:block>
                <th:block th:if="${product.reviewCount == 0}">
                    <div><h3>No customer reviews yet!</h3></div>
                </th:block>
                <th:block th:each="review : ${reviews}">
                    <div class="ps-4 pe-4 pb-4">
                        <div>
                            <input type="text" class="product-details-star-rating" dir="ltr" data-size="xs" th:value="${review.rating}" />
                        </div>
                        <div class="mt-2"><b>[[${review.headline}]]</b></div>
                        <div class="mt-2">[[${review.comment}]]</div>
                        <div th:if="${review.moderated}"><sub class="text-info">(moderated)</sub></div>
                        <div>
                            <sub>[[${review.customer.fullName}]], [[${#dates.format(review.reviewTime, 'yyyy-MM-dd HH:mm:ss')}]]</sub>
                        </div>
                        <div><hr></div>
                    </div>
                </th:block>
            </div>
        </div>
        <th:block th:replace="fragments/images_carousel :: content"></th:block>
        <th:block th:replace="fragments/navigation :: footer_nav"></th:block>
        <th:block th:replace="fragments/modal :: shopmeModal"></th:block>
    </div>
<script type="text/javascript">
    const contextPath = "[[@{/}]]";
    const productId = "[[${product.id}]]";
    const csrfHeaderName = "[[${_csrf.headerName}]]";
    const csrfHeaderValue = "[[${_csrf.token}]]";

    $(document).ready(function () {
        let bigImage = $("#bigImage");
        $(".image-thumbnail").mouseover(function (e) {
            let currentImageSrc = $(this).attr("src");
            let currentImageIndex = $(this).attr("index");

            $(bigImage).attr("src", currentImageSrc);
            $(bigImage).attr("index", currentImageIndex);
        });

        $(bigImage).click(function (e) {
            $("#carouselModal").modal("show");
            let imageIndex = parseInt(bigImage.attr("index"));
            $("#carouselExampleIndicators").carousel(imageIndex);
        });

        $(".product-details-star-rating").rating({
            displayOnly: true,
            hoverOnClear: false,
            showCaption: false,
            theme: "krajee-svg",
        });

        $(".customer-reviews-star-rating").rating({
            displayOnly: true,
            hoverOnClear: false,
            showCaption: false,
            theme: "krajee-svg",
        });
    });
</script>
<script type="text/javascript" th:src="@{/js/shopping_cart/quantity_control.js}"></script>
<script type="text/javascript" th:src="@{/js/common_modal.js}"></script>
<script type="text/javascript" th:src="@{/js/shopping_cart/add_to_cart.js}"></script>
</body>
</html>